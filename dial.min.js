/*
 * 转盘游戏
 *
 * author: billchen(48838096@qq.com)
 * website: http://www.xhyo.com/
 * date: 2016.05.30
 *
 */
;
Dial.prototype.start=function(index){if(this.state!==1){return;}
this.state=2;var _this=this,x=-this.width/2,y=-this.height/2,startTime=Date.now();if(index!=undefined){this.finishDegree=this.rounds+(index%this.length+.5)/this.length;}else{this.finishDegree=-1;}
this.counter=0;this.currentDuration=this.duration;function draw(){var time=Date.now(),degree=(time-startTime)/_this.currentDuration,isEnd=false;if(degree>=1){_this.counter++;startTime=time;degree=totalDegree+=1;if(_this.event.onroundend)
_this.event.onroundend();}else
degree=totalDegree+degree;if((_this.finishDegree>-1&&degree>=_this.finishDegree)||_this.state==1){if(_this.state==1){_this.index=Math.floor((degree%1)*_this.length);degree=_this.degree=(_this.index+.5)/_this.length;}else{_this.state=1;degree=_this.degree=_this.finishDegree%1;}
if(_this.event.onend)
_this.event.onend();isEnd=true;}else
degree=degree%1;_this.index=Math.floor(degree*_this.length);_this.ctx.save();_this.ctx.clearRect(x,y,_this.width,_this.height);_this.ctx.drawImage(_this.image,0,0,_this.image.width/2,_this.image.height,x,y,_this.width,_this.height);_this.ctx.rotate(degree*Math.PI*2);_this.ctx.drawImage(_this.image,_this.image.width/2,0,_this.image.width/2,_this.image.height,x,y,_this.width,_this.height);_this.ctx.restore();if(!isEnd)
_this.animationId=window.requestAnimationFrame(arguments.callee);};draw();};

